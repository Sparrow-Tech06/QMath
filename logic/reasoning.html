<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Math Reasoning Sprint</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/howler@2.2.4/dist/howler.min.js"></script>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
*{font-family:Inter,sans-serif}
body{background:#f6f7fb}
.game{max-width:420px;margin:auto;padding:15px}
.top{display:flex;justify-content:space-between;margin-bottom:10px}
.card{border-radius:14px;padding:20px}
.q{font-size:18px;font-weight:600;margin-bottom:15px}
.options-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.opt{
  border:1px solid #dee2e6;
  padding:12px;
  text-align:center;
  border-radius:10px;
  cursor:pointer;
  font-weight:500;
  background:#fff;
}
.opt:hover{background:#f1f3f5}
.submit{margin-top:15px}
</style>
</head>

<body>

<div class="game">

  <div class="top">
    <span id="timerBox"></span>
    <span id="progress">Played: 0 / 10</span>
  </div>

  <div class="card shadow-sm">
    <div class="q" id="question">Loading...</div>
    <div id="options" class="options-grid"></div>

    <button id="submitBtn"
      class="btn btn-outline-primary w-100 submit"
      onclick="endGame(true)"
      style="display:none">
      Submit & Finish
    </button>
  </div>

</div>

<script>
/* ===== SETTINGS ===== */
const timerOn = localStorage.getItem('timerOn') === '1';
const soundOn = localStorage.getItem('soundOn') === '1';

/* ===== SOUNDS ===== */
const click   = new Howl({ src:['../assets/sound/click.mp3'], volume:.5 });
const correct = new Howl({ src:['../assets/sound/correct.mp3'], volume:.6 });
const wrong   = new Howl({ src:['../assets/sound/wrong.mp3'], volume:.6 });

/* ===== STATE ===== */
let time = 30;
let score = 0;
let index = 0;
const total = 10;
let timerRef = null;
let gameEnded = false;

let questions = [];
let currentQ = null;

const timerBox = document.getElementById('timerBox');
const progress = document.getElementById('progress');
const submitBtn = document.getElementById('submitBtn');
const question = document.getElementById('question');
const options = document.getElementById('options');

/* ===== TIMER ===== */
if(timerOn){
  timerBox.innerText = `⏱ ${time}s`;
  timerRef = setInterval(()=>{
    time--;
    timerBox.innerText = `⏱ ${time}s`;
    if(time <= 0) endGame(false);
  },1000);
}else{
  timerBox.innerText = 'No Timer';
  submitBtn.style.display = 'block';
}

/* ===== LOAD QUESTIONS ===== */
async function loadQuestions(){
  const res = await fetch('./questions.json');
  questions = await res.json();
}

/* ===== NEXT QUESTION ===== */
function nextQuestion(){
  if(gameEnded) return;

  if(index === total){
    endGame(false);
    return;
  }

  index++;
  progress.innerText = `Played: ${index} / ${total}`;

  const qIndex = Math.floor(Math.random() * questions.length);
  currentQ = questions[qIndex];

  question.innerText = currentQ.q;
  options.innerHTML = '';

  currentQ.options.forEach(opt=>{
    const div = document.createElement('div');
    div.className = 'opt';
    div.innerText = opt;

    div.onclick = ()=>{
      if(gameEnded) return;
      if(soundOn) click.play();

      if(opt == currentQ.answer){
        score++;
        if(soundOn) correct.play();
      }else{
        if(soundOn) wrong.play();
      }

      nextQuestion();
    };

    options.appendChild(div);
  });
}

/* ===== END GAME ===== */
function endGame(manual){
  if(gameEnded) return;
  gameEnded = true;
  clearInterval(timerRef);

  let allowReward = timerOn || index === total;
  if(allowReward){
    localStorage.setItem('rewardKey',Date.now().toString());
  }

  localStorage.setItem('lastGame','Math Reasoning');
  localStorage.setItem('lastScore',score);
  localStorage.setItem('lastTotal',total);
  localStorage.setItem('currentGame','reasoning');

  location.replace('../result.html');
}

/* ===== START ===== */
loadQuestions().then(()=>{
  nextQuestion();
});
</script>

</body>
</html>
