<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Sprint Quiz</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

<!-- Howler -->
<script src="https://cdn.jsdelivr.net/npm/howler@2.2.4/dist/howler.min.js"></script>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<link rel="stylesheet" href="../butterfly.css">

<style>
.premium-lock{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.88);
  backdrop-filter: blur(6px);
  z-index:9999;
  display:flex;
  align-items:center;
  justify-content:center;
}
.lock-card{
  background:#111;
  color:#fff;
  padding:26px;
  width:90%;
  max-width:340px;
  border-radius:18px;
  text-align:center;
  box-shadow:0 0 40px rgba(255,193,7,.25);
}
.lock-icon{
  font-size:46px;
  color:#ffc107;
}
.price{
  font-size:18px;
  font-weight:600;
  color:#22c55e;
}
</style>
</head>

<body>

<!-- üîê PREMIUM LOCK -->
<div id="premiumLock" class="premium-lock d-none">
  <div class="lock-card">
    <i class="bi bi-lock-fill lock-icon"></i>
    <h4 class="mt-2">Premium Game</h4>
    <p>Unlock <b>Sprint Quiz</b> for 24 Hours</p>
    <div class="price">üí∞ 10 Coins</div>
    <button class="btn btn-warning w-100 mt-3" id="unlockBtn">
      Unlock Now
    </button>
    <small class="text-muted d-block mt-3">
      Access expires automatically
    </small>
  </div>
</div>

<!-- üéÆ GAME -->
<div class="game">
  <div class="top">
    <span id="timerBox"></span>
    <span id="progress">Played: 0 / 20</span>
  </div>

  <div class="card">
    <div class="q" id="question"></div>
    <div id="options" class="options-grid"></div>
  </div>
</div>

<script src="../menu.js"></script>
<script src="answer-feedback.js"></script>

<!-- üîê PREMIUM ACCESS (MUST LOAD BEFORE GAME) -->
<script src="premium-access.js"></script>

<script>
/* =====================================================
   GLOBAL GAME STATE (LOCK SAFE)
===================================================== */

let GAME_ALLOWED = false;   // üî¥ main switch
let gameEnded = false;
let timerRef = null;

/* =====================================================
   SETTINGS
===================================================== */
const timerOn = localStorage.getItem('timerOn') === '1';
const soundOn = localStorage.getItem('soundOn') === '1';

const click   = new Howl({ src:['../assets/sound/click.mp3'], volume:.5 });
const correct = new Howl({ src:['../assets/sound/correct.mp3'], volume:.6 });
const wrong   = new Howl({ src:['../assets/sound/wrong.mp3'], volume:.6 });

let time = 30;
let score = 0;
let index = 0;
const total = 20;

const timerBox = document.getElementById('timerBox');
const progress = document.getElementById('progress');
const question = document.getElementById('question');
const options  = document.getElementById('options');

/* =====================================================
   GAME START (ONLY IF PREMIUM)
===================================================== */
function startGame(){
  if(GAME_ALLOWED) return;
  GAME_ALLOWED = true;

  // ‚è± Timer
  if(timerOn){
    timerBox.innerText = `‚è± ${time}s`;
    timerRef = setInterval(()=>{
      if(!GAME_ALLOWED) return;
      time--;
      timerBox.innerText = `‚è± ${time}s`;
      if(time <= 0) endGame();
    },1000);
  }else{
    timerBox.innerText = 'No Timer';
  }

  nextQuestion();
}

/* =====================================================
   QUESTIONS
===================================================== */
function nextQuestion(){
  if(!GAME_ALLOWED || gameEnded) return;

  if(index === total){
    endGame();
    return;
  }

  index++;
  progress.innerText = `Played: ${index} / ${total}`;

  const a = Math.floor(Math.random()*10);
  const b = Math.floor(Math.random()*10);
  const ans = a + b;

  question.innerText = `${a} + ${b} = ?`;
  options.innerHTML = '';

  const correctPos = Math.floor(Math.random()*4);

  for(let i=0;i<4;i++){
    const val = i === correctPos ? ans : ans + Math.floor(Math.random()*6)+1;
    const div = document.createElement('div');
    div.className = 'opt';
    div.innerText = val;

    div.onclick = ()=>{
      if(!GAME_ALLOWED || gameEnded) return;

      options.querySelectorAll('.opt')
        .forEach(o=>o.style.pointerEvents='none');

      if(soundOn) click.play();

      if(val === ans){
        score++;
        if(soundOn) correct.play();
      }else{
        if(soundOn) wrong.play();
      }

      setTimeout(nextQuestion,600);
    };
    options.appendChild(div);
  }
}

/* =====================================================
   END GAME (LOCK SAFE)
===================================================== */
function endGame(){
  if(!GAME_ALLOWED || gameEnded) return;

  gameEnded = true;
  clearInterval(timerRef);

  localStorage.setItem('lastGame','Sprint Quiz');
  localStorage.setItem('lastScore',score);
  localStorage.setItem('lastTotal',total);
  localStorage.setItem('currentGame','sprint');

  location.replace('../result.html');
}

/* =====================================================
   PREMIUM CALLBACK (FROM premium-access.js)
===================================================== */
window.onPremiumGranted = function(){
  document.getElementById('premiumLock').classList.add('d-none');
  startGame();
};
</script>

</body>
</html>

